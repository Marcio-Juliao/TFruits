<!DOCTYPE html>
<html lang="ptbr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - TFruit</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="dashboard_dados.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">

</head>

<body onload="result()">
    <!--Nav-->

    <div class="nav">
        <div class="nav_esquerda">
            <button class="sair"><a onclick="sair()">sair</a></button>
            <button class="cadastrar"> <a href="dashboard_adm.html">dashboard</a></button>
            <button class="dashboard">histórico</button>
            <button class="cadastrar"><a href="dashboard_cadastrar.html">cadastrar</a></button>
            <button class="cadastrar"><a
                    href="https://tfruitcontato.atlassian.net/servicedesk/customer/portal/2">suporte</a></button>
        </div>
        <div class="nav_direita">
            <div>
                <span id="b_usuario">usuário</span> <br>
                <span id="b_empresa">empresa</span>
            </div>
            <div class="img_nav">
                <img src="imagens/banana.png" alt="">
            </div>
        </div>
    </div>

    <!--Footer-->
    <div class="footer">
        <img src="imagens/Logo_footer.png" alt="">
    </div>
</body>

</html>
<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    b_empresa.innerHTML = sessionStorage.NOME_EMPRESA;

    function sair() {
        sessionStorage.clear();
        window.location = "./index.html";
    }


    function result() {

        var id = 1;

        setInterval(function () {

            fetch("/graficos/result", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    idServer: id
                })
            }).then(function (resposta) {

                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));

                        if (json[0].valor < 10 || json[0].valor > 14) {
                            alerta.innerHTML += `<p>Caixa instável! A temeperatura chegou a ${json[0].valor}</p>`;
                            
                        } 




                    });

                } else {

                    console.log("Houve um erro ao tentar mostrar a temperatura");

                    resposta.text().then(texto => {
                        console.error(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
            })
        }

            , 5000)
        return false;
    }


</script>